From: Beren Minor <beren.minor+git@gmail.com>
Date: Fri, 1 Jun 2012 20:34:26 +0200
Subject: DEBIAN: Fix undefined reference to unlink by including unistd.h.

---
 CMakeLists.txt                            |    4 ++++
 gemrb/core/Interface.cpp                  |    2 +-
 gemrb/core/SaveGameIterator.cpp           |    4 ++--
 gemrb/core/System/VFS.cpp                 |    4 ++--
 gemrb/plugins/BAMImporter/BAMImporter.cpp |    2 +-
 gemrb/plugins/BIKPlayer/BIKPlayer.cpp     |    2 +-
 gemrb/plugins/MVEPlayer/mve_player.cpp    |    2 +-
 gemrb/plugins/WEDImporter/WEDImporter.cpp |    2 +-
 8 files changed, 13 insertions(+), 9 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 330b90d..76f611f 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -262,6 +262,10 @@ CHECK_FUNCTION_EXISTS("strndup" HAVE_STRNDUP)
 CHECK_INCLUDE_FILES("unistd.h" HAVE_UNISTD_H)
 CHECK_INCLUDE_FILES("malloc.h" HAVE_MALLOC_H)
 
+IF(HAVE_UNISTD_H EQUAL 1)
+  ADD_DEFINITIONS("-DHAVE_UNISTD_H")
+ENDIF()
+
 #Unneeded on windows
 IF(NOT WIN32)
 	INCLUDE (CheckCXXSourceCompiles)
diff --git a/gemrb/core/Interface.cpp b/gemrb/core/Interface.cpp
index d4c3806..ea71a60 100644
--- a/gemrb/core/Interface.cpp
+++ b/gemrb/core/Interface.cpp
@@ -83,7 +83,7 @@
 #include "System/FileStream.h"
 #include "System/VFS.h"
 
-#if defined(__HAIKU__)
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
 #endif
 
diff --git a/gemrb/core/SaveGameIterator.cpp b/gemrb/core/SaveGameIterator.cpp
index 8b79b06..1575890 100644
--- a/gemrb/core/SaveGameIterator.cpp
+++ b/gemrb/core/SaveGameIterator.cpp
@@ -38,10 +38,10 @@
 #include "Scriptable/Actor.h"
 #include "System/FileStream.h"
 
-#if defined(__HAIKU__)
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-
+ 
 #include <cassert>
 #include <set>
 #include <time.h>
diff --git a/gemrb/core/System/VFS.cpp b/gemrb/core/System/VFS.cpp
index 64687b7..98c3407 100644
--- a/gemrb/core/System/VFS.cpp
+++ b/gemrb/core/System/VFS.cpp
@@ -27,10 +27,10 @@
 
 #include "Interface.h"
 
-#if defined(__HAIKU__)
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-
+ 
 #include <cstdarg>
 #include <cstring>
 #include <cerrno>
diff --git a/gemrb/plugins/BAMImporter/BAMImporter.cpp b/gemrb/plugins/BAMImporter/BAMImporter.cpp
index b348eab..df03b0e 100644
--- a/gemrb/plugins/BAMImporter/BAMImporter.cpp
+++ b/gemrb/plugins/BAMImporter/BAMImporter.cpp
@@ -18,7 +18,7 @@
  *
  */
 
-#if defined(__HAIKU__)
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
 #endif
 
diff --git a/gemrb/plugins/BIKPlayer/BIKPlayer.cpp b/gemrb/plugins/BIKPlayer/BIKPlayer.cpp
index 071edce..071c134 100644
--- a/gemrb/plugins/BIKPlayer/BIKPlayer.cpp
+++ b/gemrb/plugins/BIKPlayer/BIKPlayer.cpp
@@ -30,7 +30,7 @@
  * Copyright (c) 2009 Konstantin Shishkov
 */
 
-#if defined(__HAIKU__)
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
 #endif
 
diff --git a/gemrb/plugins/MVEPlayer/mve_player.cpp b/gemrb/plugins/MVEPlayer/mve_player.cpp
index 79376a3..90a43dd 100644
--- a/gemrb/plugins/MVEPlayer/mve_player.cpp
+++ b/gemrb/plugins/MVEPlayer/mve_player.cpp
@@ -25,7 +25,7 @@
  * Jens Granseuer <jensgr@gmx.net>
  */
 
-#if defined(__HAIKU__)
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
 #endif
 
diff --git a/gemrb/plugins/WEDImporter/WEDImporter.cpp b/gemrb/plugins/WEDImporter/WEDImporter.cpp
index f662ce7..154ee38 100644
--- a/gemrb/plugins/WEDImporter/WEDImporter.cpp
+++ b/gemrb/plugins/WEDImporter/WEDImporter.cpp
@@ -18,7 +18,7 @@
  *
  */
 
-#if defined(__HAIKU__)
+#ifdef HAVE_UNISTD_H
 #include <unistd.h>
 #endif
 
